<!-- src/app/pages/register/register.page.html -->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Registro</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="register-container">
    
    <!-- Header -->
    <div class="header-section">
      <ion-text color="primary">
        <h1>Crear Cuenta</h1>
      </ion-text>
      <ion-text color="medium">
        <p>Completa la información para registrarte</p>
      </ion-text>
    </div>

    <!-- Formulario de registro -->
    <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Información Personal</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <!-- Nombre -->
          <ion-item class="input-item">
            <ion-label position="stacked">Nombre *</ion-label>
            <ion-input
              type="text"
              formControlName="nombre"
              placeholder="Tu nombre"
              autocomplete="given-name"
              [class.ion-invalid]="nombre?.invalid && nombre?.touched"
              [class.ion-valid]="nombre?.valid && nombre?.touched">
            </ion-input>
            
            <div class="error-messages" *ngIf="nombre?.invalid && nombre?.touched">
              <ion-text color="danger" *ngIf="nombre?.errors?.['required']">
                <small>El nombre es requerido</small>
              </ion-text>
              <ion-text color="danger" *ngIf="nombre?.errors?.['minlength']">
                <small>El nombre debe tener al menos 2 caracteres</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- Apellido -->
          <ion-item class="input-item">
            <ion-label position="stacked">Apellido *</ion-label>
            <ion-input
              type="text"
              formControlName="apellido"
              placeholder="Tu apellido"
              autocomplete="family-name"
              [class.ion-invalid]="apellido?.invalid && apellido?.touched"
              [class.ion-valid]="apellido?.valid && apellido?.touched">
            </ion-input>
            
            <div class="error-messages" *ngIf="apellido?.invalid && apellido?.touched">
              <ion-text color="danger" *ngIf="apellido?.errors?.['required']">
                <small>El apellido es requerido</small>
              </ion-text>
              <ion-text color="danger" *ngIf="apellido?.errors?.['minlength']">
                <small>El apellido debe tener al menos 2 caracteres</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- Email -->
          <ion-item class="input-item">
            <ion-label position="stacked">Email *</ion-label>
            <ion-input
              type="email"
              formControlName="email"
              placeholder="ejemplo@correo.com"
              autocomplete="email"
              [class.ion-invalid]="email?.invalid && email?.touched"
              [class.ion-valid]="email?.valid && email?.touched">
            </ion-input>
            
            <div class="error-messages" *ngIf="email?.invalid && email?.touched">
              <ion-text color="danger" *ngIf="email?.errors?.['required']">
                <small>El email es requerido</small>
              </ion-text>
              <ion-text color="danger" *ngIf="email?.errors?.['email']">
                <small>Ingresa un email válido</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- Teléfono -->
          <ion-item class="input-item">
            <ion-label position="stacked">Teléfono</ion-label>
            <ion-input
              type="tel"
              formControlName="telefono"
              placeholder="+54 9 11 1234-5678"
              autocomplete="tel">
            </ion-input>
            
            <div class="error-messages" *ngIf="telefono?.invalid && telefono?.touched">
              <ion-text color="danger" *ngIf="telefono?.errors?.['pattern']">
                <small>Ingresa un número de teléfono válido</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- ID Empleado -->
          <ion-item class="input-item">
            <ion-label position="stacked">ID Empleado</ion-label>
            <ion-input
              type="text"
              formControlName="employeeId"
              placeholder="Ej: EMP001">
            </ion-input>
          </ion-item>

          <!-- Departamento -->
          <ion-item class="input-item">
            <ion-label position="stacked">Departamento</ion-label>
            <ion-select 
              formControlName="departamento"
              placeholder="Seleccionar departamento"
              interface="popover">
              <ion-select-option value="administracion">Administración</ion-select-option>
              <ion-select-option value="ventas">Ventas</ion-select-option>
              <ion-select-option value="marketing">Marketing</ion-select-option>
              <ion-select-option value="desarrollo">Desarrollo</ion-select-option>
              <ion-select-option value="recursos-humanos">Recursos Humanos</ion-select-option>
              <ion-select-option value="contabilidad">Contabilidad</ion-select-option>
              <ion-select-option value="operaciones">Operaciones</ion-select-option>
              <ion-select-option value="otro">Otro</ion-select-option>
            </ion-select>
          </ion-item>

          <!-- Contraseña -->
          <ion-item class="input-item">
            <ion-label position="stacked">Contraseña *</ion-label>
            <ion-input
              type="password"
              formControlName="password"
              placeholder="Mínimo 6 caracteres"
              autocomplete="new-password"
              [class.ion-invalid]="password?.invalid && password?.touched"
              [class.ion-valid]="password?.valid && password?.touched">
            </ion-input>
            
            <div class="error-messages" *ngIf="password?.invalid && password?.touched">
              <ion-text color="danger" *ngIf="password?.errors?.['required']">
                <small>La contraseña es requerida</small>
              </ion-text>
              <ion-text color="danger" *ngIf="password?.errors?.['minlength']">
                <small>La contraseña debe tener al menos 6 caracteres</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- Confirmar Contraseña -->
          <ion-item class="input-item">
            <ion-label position="stacked">Confirmar Contraseña *</ion-label>
            <ion-input
              type="password"
              formControlName="confirmPassword"
              placeholder="Repite tu contraseña"
              autocomplete="new-password"
              [class.ion-invalid]="confirmPassword?.invalid && confirmPassword?.touched"
              [class.ion-valid]="confirmPassword?.valid && confirmPassword?.touched">
            </ion-input>
            
            <div class="error-messages" *ngIf="confirmPassword?.invalid && confirmPassword?.touched">
              <ion-text color="danger" *ngIf="confirmPassword?.errors?.['required']">
                <small>Confirma tu contraseña</small>
              </ion-text>
            </div>
            
            <!-- Error de coincidencia de contraseñas -->
            <div class="error-messages" *ngIf="registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched">
              <ion-text color="danger">
                <small>Las contraseñas no coinciden</small>
              </ion-text>
            </div>
          </ion-item>

          <!-- Botón de registro -->
          <div class="button-section">
            <ion-button 
              expand="block" 
              type="submit" 
              [disabled]="registerForm.invalid || isLoading"
              color="primary">
              <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
              <span *ngIf="!isLoading">Crear Cuenta</span>
              <span *ngIf="isLoading">Creando...</span>
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </form>

    <!-- Footer -->
    <div class="footer-section">
      <ion-text color="medium">
        <p>¿Ya tienes una cuenta?</p>
      </ion-text>
      <ion-button 
        fill="clear" 
        color="primary" 
        (click)="goToLogin()">
        Iniciar Sesión
      </ion-button>
    </div>

  </div>
</ion-content>