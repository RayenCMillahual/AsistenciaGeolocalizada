<!-- src/app/pages/home/home.page.html -->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Sistema de Asistencia</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToHistory()" fill="clear">
        <ion-icon name="stats-chart-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="logout()" fill="clear">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content
      pullingIcon="refresh-outline"
      pullingText="Desliza para actualizar"
      refreshingSpinner="crescent"
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="home-container ion-padding">
    
    <!-- Saludo y fecha/hora -->
    <div class="welcome-section">
      <ion-text color="primary">
        <h1>¡Hola, {{ currentUser?.nombre || 'Usuario' }}!</h1>
      </ion-text>
      
      <div class="datetime-info">
        <ion-text color="medium">
          <p>{{ currentDateString }}</p>
        </ion-text>
        <ion-text color="dark">
          <h2>{{ currentTimeString }}</h2>
        </ion-text>
      </div>
    </div>

    <!-- Estado actual -->
    <ion-card class="status-card">
      <ion-card-header>
        <ion-card-title>Estado Actual</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <div class="status-info">
          <ion-badge [color]="getAttendanceStatusColor()" class="status-badge">
            {{ getAttendanceStatusText() }}
          </ion-badge>
          
          <div class="attendance-details" *ngIf="todayAttendances.entrada || todayAttendances.salida">
            <ion-item *ngIf="todayAttendances.entrada" lines="none">
              <ion-icon name="checkmark-circle-outline" color="success" slot="start"></ion-icon>
              <ion-label>
                <h3>Entrada registrada</h3>
                <p>{{ todayAttendances.entrada.hora }}</p>
              </ion-label>
            </ion-item>
            
            <ion-item *ngIf="todayAttendances.salida" lines="none">
              <ion-icon name="checkmark-circle-outline" color="success" slot="start"></ion-icon>
              <ion-label>
                <h3>Salida registrada</h3>
                <p>{{ todayAttendances.salida.hora }}</p>
              </ion-label>
            </ion-item>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Botones de acción -->
    <div class="action-buttons">
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-button 
              expand="block" 
              fill="solid"
              color="success"
              [disabled]="!canCheckIn"
              (click)="registerEntry()"
              class="action-button">
              <ion-icon name="time-outline" slot="start"></ion-icon>
              Registrar Entrada
            </ion-button>
          </ion-col>
          
          <ion-col size="6">
            <ion-button 
              expand="block" 
              fill="solid"
              color="danger"
              [disabled]="!canCheckOut"
              (click)="registerExit()"
              class="action-button">
              <ion-icon name="time-outline" slot="start"></ion-icon>
              Registrar Salida
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <!-- Información adicional -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>Información</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item *ngIf="currentUser?.departamento" lines="none">
          <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Departamento</h3>
            <p>{{ currentUser?.departamento }}</p>
          </ion-label>
        </ion-item>
        
        <ion-item *ngIf="currentUser?.employeeId" lines="none">
          <ion-icon name="card-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>ID Empleado</h3>
            <p>{{ currentUser?.employeeId }}</p>
          </ion-label>
        </ion-item>
        
        <ion-item button (click)="goToHistory()" lines="none">
          <ion-icon name="stats-chart-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Ver Historial</h3>
            <p>Consulta tus registros anteriores</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Recordatorios -->
    <div class="reminders-section" *ngIf="!todayAttendances.entrada || !todayAttendances.salida">
      <ion-text color="medium">
        <h3>Recordatorios</h3>
      </ion-text>
      
      <div class="reminder-item" *ngIf="!todayAttendances.entrada">
        <ion-icon name="time-outline" color="warning"></ion-icon>
        <span>No olvides registrar tu entrada al llegar</span>
      </div>
      
      <div class="reminder-item" *ngIf="todayAttendances.entrada && !todayAttendances.salida">
        <ion-icon name="time-outline" color="warning"></ion-icon>
        <span>Recuerda registrar tu salida al finalizar</span>
      </div>
    </div>

  </div>
</ion-content>